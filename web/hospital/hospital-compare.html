<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>ë³‘ì› ë¹„êµ - í¼í«íŠ¸</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="hospital-compare-styles.css" />
    <link rel="stylesheet" href="../common/category-tabs.css" />
    <link rel="stylesheet" href="../common/tabbar.css" />
  </head>
  <body>
    <!-- ì§€ë„ ë ˆì´ì–´ (ë°°ê²½) -->
    <div class="map-container" id="mapContainer"></div>

    <!-- í•˜ë‹¨ ì‹œíŠ¸ (ë“œë˜ê·¸ ê°€ëŠ¥) -->
    <div class="bottom-sheet" id="bottomSheet">
      <!-- ë“œë˜ê·¸ í•¸ë“¤ -->
      <div class="sheet-handle" id="sheetHandle">
        <div class="handle-bar"></div>
      </div>

      <!-- ì‹œíŠ¸ ë‚´ìš© -->
      <div class="sheet-content">
        <!-- ê²€ìƒ‰ ë°” -->
        <div class="search-bar">
          <svg
            class="search-icon"
            width="20"
            height="20"
            viewBox="0 0 20 20"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <circle
              cx="9"
              cy="9"
              r="6"
              stroke="#a3a3a3"
              stroke-width="1.5"
              fill="none"
            />
            <path
              d="M13 13L17 17"
              stroke="#a3a3a3"
              stroke-width="1.5"
              stroke-linecap="round"
            />
          </svg>
          <input
            type="text"
            class="search-input"
            placeholder="ê¶ê¸ˆí•˜ì‹  ì§ˆí™˜ì„ ê²€ìƒ‰í•´ì£¼ì„¸ìš”."
          />
        </div>

        <!-- ì¹´í…Œê³ ë¦¬ íƒ­ -->
        <div class="category-tabs">
          <div class="category-tab active">ì¢…í•©ê´€ë¦¬</div>
          <div class="category-tab">ì‹¬ì¥</div>
          <div class="category-tab">ê°„</div>
          <div class="category-tab">ìœ„/ì¥</div>
          <div class="category-tab">í”¼ë¶€</div>
          <div class="category-tab">ì¹˜ì•„</div>
          <div class="category-tab">ë¼ˆ/ê´€ì ˆ</div>
          <div class="category-tab">ëˆˆ</div>
          <div class="category-tab">ë©´ì—­ë ¥</div>
          <div class="category-tab">í–‰ë™</div>
          <div class="category-tab">ì‹ ì¥/ë°©ê´‘</div>
        </div>

        <!-- 24ì‹œê°„ ë²„íŠ¼ -->
        <div class="filter-section">
          <button class="filter-24h">
            <span>24h</span>
          </button>
        </div>

        <!-- ê°€ê²©ë¹„êµ ì„¹ì…˜ -->
        <div class="price-section">
          <div class="section-title">í¼í«íŠ¸í•œ ê°€ê²©ë¹„êµ</div>
          <div class="price-cards">
            <div class="price-card-wrapper">
              <div class="price-label-badge">
                <svg
                  class="price-label-ribbon"
                  width="81"
                  height="30"
                  viewBox="0 0 273 30"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                  preserveAspectRatio="none"
                >
                  <path
                    d="M6 0H267V25C267 27.7614 264.761 30 262 30H11C8.23858 30 6 27.7614 6 25V0Z"
                    fill="#BBE8FF"
                  />
                  <path d="M0 12L6 0V12H0Z" fill="#BBE8FF" />
                  <path d="M273 12L267 0V12H273Z" fill="#BBE8FF" />
                </svg>
                <span class="price-label-text">ì´ˆì§„ ì§„ì°°ë£Œ</span>
              </div>
              <div class="price-card">
                <div class="price-content">
                  <div class="price-average-label">í‰ê· </div>
                  <div class="price-value">10,000ì›</div>
                </div>
              </div>
            </div>
            <div class="price-card-wrapper">
              <div class="price-label-badge">
                <svg
                  class="price-label-ribbon"
                  width="81"
                  height="30"
                  viewBox="0 0 273 30"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                  preserveAspectRatio="none"
                >
                  <path
                    d="M6 0H267V25C267 27.7614 264.761 30 262 30H11C8.23858 30 6 27.7614 6 25V0Z"
                    fill="#BBE8FF"
                  />
                  <path d="M0 12L6 0V12H0Z" fill="#BBE8FF" />
                  <path d="M273 12L267 0V12H273Z" fill="#BBE8FF" />
                </svg>
                <span class="price-label-text">ì¬ì§„ ì§„ì°°ë£Œ</span>
              </div>
              <div class="price-card">
                <div class="price-content">
                  <div class="price-average-label">í‰ê· </div>
                  <div class="price-value">10,000ì›</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ë³‘ì› ë¦¬ìŠ¤íŠ¸ ì„¹ì…˜ -->
        <div class="hospital-section">
          <div class="section-title">í¼í«íŠ¸í•œ ë§ì¶¤ë³‘ì›</div>
          <div class="hospital-list">
            <div class="hospital-card">
              <div class="hospital-image"></div>
              <div class="hospital-info">
                <div class="hospital-header">
                  <div class="hospital-name">ìŠ¤ë§ˆíŠ¸ë™ë¬¼ë³‘ì›</div>
                  <div class="hospital-rating">â­ 4.4(636)</div>
                </div>
                <div class="hospital-details">
                  <div class="detail-item">24ì‹œê°„ ìš´ì˜</div>
                  <div class="detail-item">ì„œìš¸ ê°•ë‚¨êµ¬ ë„ì‚°ëŒ€ë¡œ 213 1ì¸µ</div>
                  <div class="detail-item">0507-1406-0275</div>
                  <div class="detail-item">í•­ì•”, ìˆ˜ìˆ  ì „ë¬¸</div>
                </div>
                <div class="hospital-actions">
                  <button class="action-btn primary">ì˜ˆì•½í•˜ê¸°</button>
                  <button class="action-btn secondary">ìƒì„¸ì •ë³´</button>
                </div>
              </div>
              <div class="hospital-badge">í¼í«íŠ¸ë§ì¶¤</div>
            </div>

            <!-- ì¶”ê°€ ë³‘ì› ì¹´ë“œë“¤ -->
            <div class="hospital-card">
              <div class="hospital-image"></div>
              <div class="hospital-info">
                <div class="hospital-header">
                  <div class="hospital-name">ê°•ë‚¨ë™ë¬¼ë³‘ì›</div>
                  <div class="hospital-rating">â­ 4.6 (32)</div>
                </div>
                <div class="hospital-details">
                  <div class="detail-item">í‰ì¼ 09:00-21:00</div>
                  <div class="detail-item">ì„œìš¸ ê°•ë‚¨êµ¬ í…Œí—¤ë€ë¡œ 123</div>
                  <div class="detail-item">02-1234-5678</div>
                  <div class="detail-item">ì¢…í•© ì§„ë£Œ</div>
                </div>
                <div class="hospital-actions">
                  <button class="action-btn primary">ì˜ˆì•½í•˜ê¸°</button>
                  <button class="action-btn">ìƒì„¸ì •ë³´</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- TabBar -->
    <div class="tabbar">
      <div class="tabbar-tabs">
        <div class="tab-item">
          <img src="../svg/shop.svg" alt="ìì‚¬ëª°" class="tab-icon" />
          <span class="tab-label">ìì‚¬ëª°</span>
        </div>
        <div class="tab-item active">
          <img src="../svg/hospital.svg" alt="ë³‘ì›" class="tab-icon" />
          <span class="tab-label">ë³‘ì›</span>
        </div>
        <div class="tab-item">
          <img src="../svg/home.svg" alt="í™ˆ" class="tab-icon" />
          <span class="tab-label">í™ˆ</span>
        </div>
        <div class="tab-item">
          <img src="../svg/vet.svg" alt="ìˆ˜ì˜ì‚¬" class="tab-icon" />
          <span class="tab-label">ìˆ˜ì˜ì‚¬</span>
        </div>
        <div class="tab-item">
          <img
            src="../svg/icon_community.svg"
            alt="ì»¤ë®¤ë‹ˆí‹°"
            class="tab-icon"
          />
          <span class="tab-label">ì»¤ë®¤ë‹ˆí‹°</span>
        </div>
      </div>
    </div>

    <script src="../common/auth-check.js"></script>
    <script src="../common/supabase-config.js"></script>
    <script src="hospital-compare-script.js"></script>
    <!-- ë„¤ì´ë²„ ì§€ë„ API - ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ í›„ì— ì¶”ê°€ -->
    <script type="text/javascript">
      // hospital-compare-script.jsê°€ ë¨¼ì € ë¡œë“œëœ í›„ ë„¤ì´ë²„ ì§€ë„ API ë¡œë“œ
      (function () {
        console.log("ë„¤ì´ë²„ ì§€ë„ API ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹œì‘");
        console.log("í˜„ì¬ URL:", window.location.href);
        console.log("Client ID: f3qp1zkzgn");

        // ì „ì—­ ë³€ìˆ˜ë¡œ ì½œë°± í˜¸ì¶œ ì—¬ë¶€ ì¶”ì 
        window.naverMapCallbackCalled = false;

        // ë„¤ì´ë²„ ì§€ë„ API ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ (ì—ëŸ¬ ì²˜ë¦¬ í¬í•¨)
        const naverMapScript = document.createElement("script");
        naverMapScript.type = "text/javascript";
        naverMapScript.src =
          "https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=f3qp1zkzgn&callback=initNaverMap";

        naverMapScript.onload = function () {
          console.log("ë„¤ì´ë²„ ì§€ë„ API ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì™„ë£Œ");
        };

        naverMapScript.onerror = function (e) {
          console.error("ë„¤ì´ë²„ ì§€ë„ API ìŠ¤í¬ë¦½íŠ¸ ë¡œë“œ ì‹¤íŒ¨:", e);
          window.naverMapCallbackCalled = true;
          setTimeout(function () {
            if (typeof showMapPlaceholder === "function") {
              showMapPlaceholder();
            } else {
              const mapContainer = document.getElementById("mapContainer");
              if (mapContainer) {
                mapContainer.innerHTML =
                  '<div style="width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;background:linear-gradient(135deg, #a5d6a7 0%, #81c784 50%, #66bb6a 100%);color:#fff;font-family:\'JejuGothic\',sans-serif;"><div style="font-size:16px;margin-bottom:8px;">ğŸ—ºï¸</div><div style="font-size:14px;text-align:center;padding:0 20px;">ì§€ë„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</div></div>';
              }
            }
          }, 500);
        };

        document.head.appendChild(naverMapScript);

        // ì „ì—­ ì—ëŸ¬ í•¸ë“¤ëŸ¬ë¡œ ë„¤ì´ë²„ ì§€ë„ API ì¸ì¦ ì˜¤ë¥˜ ìºì¹˜
        window.addEventListener(
          "error",
          function (e) {
            if (
              (e.message && e.message.includes("NAVER Maps")) ||
              (e.message && e.message.includes("Authentication Failed")) ||
              (e.filename && e.filename.includes("maps.js"))
            ) {
              console.error("ë„¤ì´ë²„ ì§€ë„ API ì¸ì¦ ì˜¤ë¥˜ ê°ì§€:", e.message);
              window.naverMapCallbackCalled = true;
              setTimeout(function () {
                if (typeof showMapPlaceholder === "function") {
                  showMapPlaceholder();
                }
              }, 1000);
            }
          },
          true
        );

        // ì¼ì • ì‹œê°„ í›„ ì½œë°±ì´ í˜¸ì¶œë˜ì§€ ì•Šìœ¼ë©´ íƒ€ì„ì•„ì›ƒ ì²˜ë¦¬ (ì¸ì¦ ì‹¤íŒ¨ ê°€ëŠ¥ì„±)
        setTimeout(function () {
          if (
            !window.naverMapCallbackCalled &&
            (typeof naver === "undefined" || !naver.maps)
          ) {
            console.warn("âš ï¸ ë„¤ì´ë²„ ì§€ë„ API ì½œë°±ì´ í˜¸ì¶œë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");
            console.warn("í˜„ì¬ URL:", window.location.href);
            console.warn("Client ID: f3qp1zkzgn");
            console.warn(
              "ë“±ë¡ëœ URL í™•ì¸ í•„ìš”: https://perpet.netlify.app (ë„ë©”ì¸ë§Œ, ê²½ë¡œ ì œì™¸)"
            );
            if (typeof showMapPlaceholder === "function") {
              showMapPlaceholder();
            }
          }
        }, 5000);
      })();
    </script>
    <script src="../common/tabbar.js"></script>
    <script>
      // ì¸ì¦ ì²´í¬
      document.addEventListener("DOMContentLoaded", function () {
        checkAuth();
      });
    </script>
  </body>
</html>
